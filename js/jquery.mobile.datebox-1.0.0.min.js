/*
 * jQuery Mobile Framework : plugin to provide a date and time picker.
 * Copyright (c) JTSage
 * CC 3.0 Attribution.  May be relicensed without permission/notifcation.
 * https://github.com/jtsage/jquery-mobile-datebox
 */

(function(a,b){a.widget("mobile.datebox",a.mobile.widget,{options:{version:"1.0.0-2011122900",theme:false,defaultTheme:"c",pickPageTheme:"b",pickPageInputTheme:"e",pickPageButtonTheme:"a",pickPageHighButtonTheme:"e",pickPageOHighButtonTheme:"e",pickPageOAHighButtonTheme:"e",pickPageODHighButtonTheme:"e",pickPageTodayButtonTheme:"e",pickPageSlideButtonTheme:"d",pickPageFlipButtonTheme:"b",forceInheritTheme:false,centerWindow:false,calHighToday:true,calHighPicked:true,transition:"pop",noAnimation:false,disableManualInput:false,disabled:false,wheelExists:false,swipeEnabled:true,zindex:"500",debug:false,clickEvent:"vclick",resizeListener:true,titleDialogLabel:false,meridiemLetters:["AM","PM"],timeFormats:{"12":"gg:ii AA","24":"HH:ii"},durationFormat:"DD ddd, hh:ii:ss",timeOutput:false,rolloverMode:{m:true,d:true,h:true,i:true,s:true},mode:"datebox",calShowDays:true,calShowOnlyMonth:false,useDialogForceTrue:false,useDialogForceFalse:false,fullScreen:false,fullScreenAlways:false,useDialog:false,useModal:false,useInline:false,useInlineBlind:false,noButtonFocusMode:false,noButton:false,noSetButton:false,openCallback:false,closeCallback:false,open:false,nestedBox:false,lastDuration:false,fieldsOrder:false,fieldsOrderOverride:false,durationOrder:["d","h","i","s"],defaultDateFormat:"YYYY-MM-DD",dateFormat:false,timeFormatOverride:false,headerFormat:false,dateOutput:false,minuteStep:1,calTodayButton:false,calWeekMode:false,calWeekModeFirstDay:1,calWeekModeHighlight:true,calStartDay:0,defaultPickerValue:false,defaultDate:false,minYear:false,maxYear:false,afterToday:false,beforeToday:false,maxDays:false,minDays:false,highDays:false,highDates:false,highDatesAlt:false,blackDays:false,blackDates:false,enableDates:false,durationSteppers:{d:1,h:1,i:1,s:1},disabledDayColor:"#888",useLang:"en",lang:{en:{setDateButtonLabel:"Set Date",setTimeButtonLabel:"Set Time",setDurationButtonLabel:"Set Duration",calTodayButtonLabel:"Jump to Today",titleDateDialogLabel:"Set Date",titleTimeDialogLabel:"Set Time",daysOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysOfWeekShort:["Su","Mo","Tu","We","Th","Fr","Sa"],monthsOfYear:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsOfYearShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],durationLabel:["Days","Hours","Minutes","Seconds"],durationDays:["Day","Days"],timeFormat:24,headerFormat:"ddd, mmm dd, YYYY",dateFieldOrder:["m","d","y"],timeFieldOrder:["h","i","a"],slideFieldOrder:["y","m","d"],dateFormat:"YYYY-MM-DD",useArabicIndic:false,isRTL:false}}},_dateboxHandler:function(c,d){if(!c.isPropagationStopped()){switch(d.method){case"close":a(this).data("datebox").close(d.fromCloseButton);break;case"open":a(this).data("datebox").open();break;case"set":a(this).val(d.value);a(this).trigger("change");break;case"doset":if(a(this).data("datebox").options.mode==="timebox"||a(this).data("datebox").options.mode==="durationbox"){a(this).trigger("datebox",{method:"set",value:a(this).data("datebox")._formatTime(a(this).data("datebox").theDate),date:a(this).data("datebox").theDate})}else{a(this).trigger("datebox",{method:"set",value:a(this).data("datebox")._formatDate(a(this).data("datebox").theDate),date:a(this).data("datebox").theDate})}break;case"dooffset":a(this).data("datebox")._offset(d.type,d.amount,true);break;case"dorefresh":a(this).data("datebox")._update();break;case"doreset":a(this).data("datebox").hardreset();break}}},_digitReplace:function(k,h){var j=48,c=57,d=1584,e=null,f=null,g="";if(h===-1){j=48+1584;c=57+1584;d=-1584}for(e=0;e<k.length;e++){f=k.charCodeAt(e);if(f>=j&&f<=c){g=g+String.fromCharCode(f+d)}else{g=g+String.fromCharCode(f)}}return g},_makeDisplayIndic:function(){var c=this,d=this.options;c.pickerContent.find("*").each(function(){if(a(this).children().length<1){a(this).text(c._digitReplace(a(this).text()))}else{if(a(this).hasClass("ui-datebox-slideday")){a(this).html(c._digitReplace(a(this).html()))}}});c.pickerContent.find("input").each(function(){a(this).val(c._digitReplace(a(this).val()))})},_zeroPad:function(c){return((c<10)?"0":"")+String(c)},_makeOrd:function(d){var c=d%10;if(d>9&&d<21){return"th"}if(c>3){return"th"}return["th","st","nd","rd"][c]},_isInt:function(c){return(c.toString().search(/^[0-9]+$/)===0)},_dstAdjust:function(c){if(!c){return null}c.setHours(c.getHours()>12?c.getHours()+2:0);return c},_getFirstDay:function(c){return new Date(c.getFullYear(),c.getMonth(),1).getDay()},_getRecDays:function(g,j,d){if(j===null){j=this.theDate.getMonth()+1}if(g===null){g=this.theDate.getFullYear()}var c=this,f=new Date(g,j-1,1,0,0,0,0),h=[],e;if(f.getDay()>d){f.setDate(8-(f.getDay()-d))}else{if(f.getDay()<d){f.setDate(1+(d-f.getDay()))}}h[0]=f.getFullYear()+"-"+c._zeroPad(f.getMonth()+1)+"-"+c._zeroPad(f.getDate());for(e=1;e<6;e++){f.setDate(f.getDate()+7);if((f.getMonth()+1)===j){h[e]=f.getFullYear()+"-"+c._zeroPad(f.getMonth()+1)+"-"+c._zeroPad(f.getDate())}}return h},_getLastDate:function(c){return 32-this._dstAdjust(new Date(c.getFullYear(),c.getMonth(),32)).getDate()},_getLastDateBefore:function(c){return 32-this._dstAdjust(new Date(c.getFullYear(),c.getMonth()-1,32)).getDate()},_formatter:function(d,c){d=d.replace("HH",this._zeroPad(c.getHours()));d=d.replace("GG",c.getHours());d=d.replace("hh",this._zeroPad(((c.getHours()===0||c.getHours()===12)?12:((c.getHours()<12)?c.getHours():c.getHours()-12))));d=d.replace("gg",((c.getHours()===0||c.getHours()===12)?12:((c.getHours()<12)?c.getHours():(c.getHours()-12))));d=d.replace("ii",this._zeroPad(c.getMinutes()));d=d.replace("ss",this._zeroPad(c.getSeconds()));d=d.replace("AA",((c.getHours()<12)?this.options.meridiemLetters[0].toUpperCase():this.options.meridiemLetters[1].toUpperCase()));d=d.replace("aa",((c.getHours()<12)?this.options.meridiemLetters[0].toLowerCase():this.options.meridiemLetters[1].toLowerCase()));d=d.replace("SS",this._makeOrd(c.getDate()));d=d.replace("YYYY",c.getFullYear());d=d.replace("mmmm",this.options.lang[this.options.useLang].monthsOfYearShort[c.getMonth()]);d=d.replace("mmm",this.options.lang[this.options.useLang].monthsOfYear[c.getMonth()]);d=d.replace("MM",this._zeroPad(c.getMonth()+1));d=d.replace("mm",c.getMonth()+1);d=d.replace("dddd",this.options.lang[this.options.useLang].daysOfWeekShort[c.getDay()]);d=d.replace("ddd",this.options.lang[this.options.useLang].daysOfWeek[c.getDay()]);d=d.replace("DD",this._zeroPad(c.getDate()));d=d.replace("dd",c.getDate());if(this.options.lang[this.options.useLang].useArabicIndic===true){d=this._digitReplace(d)}return d},_formatHeader:function(c){if(this.options.headerFormat!==false){return this._formatter(this.options.headerFormat,c)}else{return this._formatter(this.options.lang[this.options.useLang].headerFormat,c)}},_formatDate:function(c){return this._formatter(this.options.dateOutput,c)},_isoDate:function(f,c,e){return String(f)+"-"+((c<10)?"0":"")+String(c)+"-"+((e<10)?"0":"")+String(e)},_formatTime:function(d){var m=this,k=[false,false,false],c,h,f,e,l=this.options.durationFormat,g=[0,0,0,0];if(this.options.mode==="durationbox"){c=this.options.durationFormat;c=c.replace(/ddd/g,".+?");c=c.replace(/DD|ss|hh|ii/g,"([0-9Dhis]+)");c=new RegExp("^"+c+"$");h=c.exec(this.options.durationFormat);f=((m.theDate.getTime()-m.theDate.getMilliseconds())/1000)-((m.initDate.getTime()-m.initDate.getMilliseconds())/1000);e=f;g[0]=parseInt(f/(60*60*24),10);f=f-(g[0]*60*60*24);g[1]=parseInt(f/(60*60),10);f=f-(g[1]*60*60);g[2]=parseInt(f/(60),10);f=f-(g[2]*60);g[3]=f;if(!h[0].match(/DD/)){k[0]=true;g[1]=g[1]+(g[0]*24)}if(!h[0].match(/hh/)){k[1]=true;g[2]=g[2]+(g[1]*60)}if(!h[0].match(/ii/)){k[2]=true;g[3]=g[3]+(g[2]*60)}if(this.options.debug){console.log({format:h,collapse:k,seconds:e,parts:g})}l=l.replace("DD",g[0]);l=l.replace("ddd",((g[0]>1)?this.options.lang[this.options.useLang].durationDays[1]:this.options.lang[this.options.useLang].durationDays[0]));l=l.replace("hh",m._zeroPad(g[1]));l=l.replace("ii",m._zeroPad(g[2]));l=l.replace("ss",m._zeroPad(g[3]));if(this.options.lang[this.options.useLang].useArabicIndic===true){return this._digitReplace(l)}else{return l}}else{return this._formatter(m.options.timeOutput,d)}},_makeDate:function(k){k=a.trim(k);var d=this.options,n=this,e=null,m=null,l=null,c=null,f=new Date(),j=[false,false,false],g=[f.getFullYear(),f.getMonth(),f.getDate(),f.getHours(),f.getMinutes(),f.getSeconds()],h;if(d.lang[this.options.useLang].useArabicIndic===true){k=this._digitReplace(k,-1)}if(d.mode==="durationbox"){e=d.durationFormat;e=e.replace(/ddd/g,".+?");e=e.replace(/DD|ss|hh|ii/g,"([0-9Dhis]+)");e=new RegExp("^"+e+"$");m=e.exec(k);l=e.exec(d.durationFormat);if(d.debug){console.log({info:"EXPERIMENTAL REGEX MODE ENABLED",string:k,regex:e,input:m,format:l})}if(m===null||m.length!==l.length){if(typeof d.defaultPickerValue==="number"&&d.defaultPickerValue>0){return new Date(n.initDate.getTime()+(parseInt(d.defaultPickerValue,10)*1000))}else{return new Date(n.initDate.getTime())}}else{c=((n.initDate.getTime()-n.initDate.getMilliseconds())/1000);for(h=0;h<m.length;h++){if(l[h].match(/^DD$/i)){c=c+(parseInt(m[h],10)*60*60*24)}if(l[h].match(/^hh$/i)){c=c+(parseInt(m[h],10)*60*60)}if(l[h].match(/^ii$/i)){c=c+(parseInt(m[h],10)*60)}if(l[h].match(/^ss$/i)){c=c+(parseInt(m[h],10))}}return new Date((c*1000))}}else{if(d.mode==="timebox"||d.mode==="timeflipbox"){e=d.timeOutput}else{e=d.dateOutput}e=e.replace(/dddd|mmmm/g,"(.+?)");e=e.replace(/ddd|SS/g,".+?");e=e.replace(/mmm/g,"(.+?)");e=e.replace(/ *AA/ig," *(.*?)");e=e.replace(/yyyy|dd|mm|gg|hh|ii/ig,"([0-9yYdDmMgGhHi]+)");e=e.replace(/ss/g,"([0-9s]+)");e=new RegExp("^"+e+"$");m=e.exec(k);if(d.mode==="timebox"||d.mode==="timeflipbox"){l=e.exec(d.timeOutput)}else{l=e.exec(d.dateOutput)}if(d.debug){console.log({info:"EXPERIMENTAL REGEX MODE ENABLED",string:k,regex:e,input:m,format:l})}if(m===null||m.length!==l.length){if(d.defaultPickerValue!==false){if(a.isArray(d.defaultPickerValue)&&d.defaultPickerValue.length===3){if(d.mode==="timebox"||d.mode==="timeflipbox"){return new Date(g[0],g[1],g[2],d.defaultPickerValue[0],d.defaultPickerValue[1],d.defaultPickerValue[2],0)}else{return new Date(d.defaultPickerValue[0],d.defaultPickerValue[1],d.defaultPickerValue[2],0,0,0,0)}}else{if(d.mode==="timebox"||d.mode==="timeflipbox"){c=d.defaultPickerValue.split(":");if(c.length===3){f=new Date(g[0],g[1],g[2],parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10),0);if(isNaN(f.getDate())){f=new Date()}}}else{c=d.defaultPickerValue.split("-");if(c.length===3){f=new Date(parseInt(c[0],10),parseInt(c[1],10)-1,parseInt(c[2],10),0,0,0,0);if(isNaN(f.getDate())){f=new Date()}}}}}}else{for(h=0;h<m.length;h++){if(l[h].match(/^gg$/i)){g[3]=parseInt(m[h],10)}if(l[h].match(/^hh$/i)){g[3]=parseInt(m[h],10)}if(l[h].match(/^ii$/i)){g[4]=parseInt(m[h],10)}if(l[h].match(/^ss$/)){g[5]=parseInt(m[h],10)}if(l[h].match(/^dd$/i)){g[2]=parseInt(m[h],10)}if(l[h].match(/^mm$/i)){g[1]=parseInt(m[h],10)-1}if(l[h].match(/^yyyy$/i)){g[0]=parseInt(m[h],10)}if(l[h].match(/^AA$/i)){if(m[h].toLowerCase().charAt(0)==="a"&&g[3]===12){g[3]=0}else{if(m[h].toLowerCase().charAt(0)==="p"&&g[3]!==12){g[3]=g[3]+12}}}if(l[h].match(/^mmm$/i)){c=a.inArray(m[h],d.lang[d.useLang].monthsOfYear);if(c>-1){g[1]=c}}if(l[h].match(/^mmmm$/i)){c=a.inArray(m[h],d.lang[d.useLang].monthsOfYearShort);if(c>-1){g[1]=c}}}}if(l[0].match(/G|g|i|s|H|h|A/)){return new Date(g[0],g[1],g[2],g[3],g[4],g[5],0)}else{return new Date(g[0],g[1],g[2],0,0,0,0)}}},_checker:function(c){return parseInt(String(c.getFullYear())+this._zeroPad(c.getMonth()+1)+this._zeroPad(c.getDate()),10)},_hoover:function(c){a(c).toggleClass("ui-btn-up-"+a(c).attr("data-theme")+" ui-btn-down-"+a(c).attr("data-theme"))},_offset:function(f,d,g){var c=this,e=this.options;if(typeof(g)==="undefined"){g=true}c.input.trigger("datebox",{method:"offset",type:f,amount:d});switch(f){case"y":c.theDate.setYear(c.theDate.getFullYear()+d);break;case"m":if(e.debug){console.log(e.rolloverMode)}if(e.rolloverMode.m||(c.theDate.getMonth()+d<12&&c.theDate.getMonth()+d>-1)){c.theDate.setMonth(c.theDate.getMonth()+d)}break;case"d":if(e.rolloverMode.d||(c.theDate.getDate()+d>0&&c.theDate.getDate()+d<(c._getLastDate(c.theDate)+1))){c.theDate.setDate(c.theDate.getDate()+d)}break;case"h":if(e.rolloverMode.h||(c.theDate.getHours()+d>-1&&c.theDate.getHours()+d<24)){c.theDate.setHours(c.theDate.getHours()+d)}break;case"i":if(e.rolloverMode.i||(c.theDate.getMinutes()+d>-1&&c.theDate.getMinutes()+d<60)){c.theDate.setMinutes(c.theDate.getMinutes()+d)}break;case"s":if(e.rolloverMode.s||(c.theDate.getSeconds()+d>-1&&c.theDate.getSeconds()+d<60)){c.theDate.setSeconds(c.theDate.getSeconds()+d)}break;case"a":if(c.pickerMeri.val()===e.meridiemLetters[0]){c._offset("h",12,false)}else{c._offset("h",-12,false)}break}if(g===true){c._update()}},_updateduration:function(){var c=this,d=(c.initDate.getTime()-c.initDate.getMilliseconds())/1000;if(!c._isInt(c.pickerDay.val())){c.pickerDay.val(0)}if(!c._isInt(c.pickerHour.val())){c.pickerHour.val(0)}if(!c._isInt(c.pickerMins.val())){c.pickerMins.val(0)}if(!c._isInt(c.pickerSecs.val())){c.pickerSecs.val(0)}d=d+(parseInt(c.pickerDay.val(),10)*60*60*24);d=d+(parseInt(c.pickerHour.val(),10)*60*60);d=d+(parseInt(c.pickerMins.val(),10)*60);d=d+(parseInt(c.pickerSecs.val(),10));c.theDate.setTime(d*1000);c._update()},_checkConstraints:function(){var d=this,c=null,e=this.options;if(e.afterToday!==false){c=new Date();if(d.theDate<c){d.theDate=c}}if(e.beforeToday!==false){c=new Date();if(d.theDate>c){d.theDate=c}}if(e.maxDays!==false){c=new Date();c.setDate(c.getDate()+e.maxDays);if(d.theDate>c){d.theDate=c}}if(e.minDays!==false){c=new Date();c.setDate(c.getDate()-e.minDays);if(d.theDate<c){d.theDate=c}}if(e.maxYear!==false){c=new Date(e.maxYear,0,1);c.setDate(c.getDate()-1);if(d.theDate>c){d.theDate=c}}if(e.minYear!==false){c=new Date(e.minYear,0,1);if(d.theDate<c){d.theDate=c}}},_orientChange:function(i){var c=a(i.currentTarget).data("datebox"),k=c.options,f=c.focusedEl.offset(),h=c.pickerContent.outerHeight(),g=c.pickerContent.innerWidth(),j=f.top+(c.focusedEl.outerHeight()/2)-(h/2),d=f.left+(c.focusedEl.outerWidth()/2)-(g/2);i.stopPropagation();if(!c.pickerContent.is(":visible")||k.useDialog===true){return false}else{if((d+g)>a(document).width()){d=a(document).width()-g-1}if(d<0){d=0}if(k.centerWindow){d=(a(document).width()/2)-(g/2)}if((h+j)>a(document).height()){j=a(document).height()-(h+2)}if(j<45){j=45}c.pickerContent.css({top:j,left:d})}},_update:function(){var s=this,e=s.options,p=null,g,h,j,q,n,m,k,f,r,c,d={d:60*60*24,h:60*60,i:60,s:1},l={};s.input.trigger("datebox",{method:"refresh"});if(e.mode==="durationbox"){g=((s.theDate.getTime()-s.theDate.getMilliseconds())/1000)-((s.initDate.getTime()-s.initDate.getMilliseconds())/1000);if(g<0){g=0;s.theDate.setTime(s.initDate.getTime())}e.lastDuration=g;m=parseInt(g/d.d,10);g=g-(m*d.d);s.pickerDay.val(m);m=parseInt(g/d.h,10);g=g-(m*d.h);s.pickerHour.val(m);m=parseInt(g/d.i,10);g=g-(m*d.i);s.pickerMins.val(m);s.pickerSecs.val(parseInt(g,10))}if(e.mode==="timebox"){if(e.minuteStep!==1){g=s.theDate.getMinutes()%e.minuteStep;if(g!==0){s.theDate.setMinutes(s.theDate.getMinutes()-g)}}s.pickerMins.val(s._zeroPad(s.theDate.getMinutes()));if(e.lang[e.useLang].timeFormat===12||e.timeFormatOverride===12){if(s.theDate.getHours()>11){s.pickerMeri.val(e.meridiemLetters[1]);if(s.theDate.getHours()===12){s.pickerHour.val(12)}else{s.pickerHour.val(s.theDate.getHours()-12)}}else{s.pickerMeri.val(e.meridiemLetters[0]);if(s.theDate.getHours()===0){s.pickerHour.val(12)}else{s.pickerHour.val(s.theDate.getHours())}}}else{s.pickerHour.val(s.theDate.getHours())}}if(e.mode==="flipbox"||e.mode==="timeflipbox"){s._checkConstraints();f=s._makeDate(s.input.val());s.controlsHeader.html(s._formatHeader(s.theDate));for(m=0;m<e.fieldsOrder.length;m++){c=true;switch(e.fieldsOrder[m]){case"y":n=s.pickerYar.find("ul");n.html("");for(g=-15;g<16;g++){k=((f.getFullYear()===(s.theDate.getFullYear()+g))?e.pickPageHighButtonTheme:e.pickPageFlipButtonTheme);if(g===0){k=e.pickPageButtonTheme}a("<li>",{"class":"ui-body-"+k,style:((c===true)?"margin-top: -453px":"")}).html("<span>"+(s.theDate.getFullYear()+g)+"</span>").attr("data-offset",g).attr("data-theme",k).appendTo(n);if(c===true){c=false}}break;case"m":n=s.pickerMon.find("ul");n.html("");for(g=-12;g<13;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),1);p.setMonth(p.getMonth()+g);k=(f.getMonth()===p.getMonth()&&f.getYear()===p.getYear())?e.pickPageHighButtonTheme:e.pickPageFlipButtonTheme;if(g===0){k=e.pickPageButtonTheme}a("<li>",{"class":"ui-body-"+k,style:((c===true)?"margin-top: -357px":"")}).attr("data-offset",g).attr("data-theme",k).html("<span>"+e.lang[e.useLang].monthsOfYearShort[p.getMonth()]+"</span>").appendTo(n);if(c===true){c=false}}break;case"d":n=s.pickerDay.find("ul");n.html("");for(g=-15;g<16;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate());p.setDate(p.getDate()+g);k=(f.getDate()===p.getDate()&&f.getMonth()===p.getMonth()&&f.getYear()===p.getYear())?e.pickPageHighButtonTheme:e.pickPageFlipButtonTheme;if(g===0){k=e.pickPageButtonTheme}a("<li>",{"class":"ui-body-"+k,style:((c===true)?"margin-top: -453px":"")}).attr("data-offset",g).attr("data-theme",k).html("<span>"+p.getDate()+"</span>").appendTo(n);if(c===true){c=false}}break;case"h":n=s.pickerHour.find("ul");n.html("");for(g=-12;g<13;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate(),s.theDate.getHours());p.setHours(p.getHours()+g);k=(g===0)?e.pickPageButtonTheme:e.pickPageFlipButtonTheme;a("<li>",{"class":"ui-body-"+k,style:((c===true)?"margin-top: -357px":"")}).attr("data-offset",g).attr("data-theme",k).html("<span>"+((e.lang[e.useLang].timeFormat===12||e.timeFormatOverride===12)?((p.getHours()===0)?"12":((p.getHours()<12)?p.getHours():((p.getHours()===12)?"12":(p.getHours()-12)))):p.getHours())+"</span>").appendTo(n);if(c===true){c=false}}break;case"i":n=s.pickerMins.find("ul");n.html("");for(g=-30;g<31;g++){if(e.minuteStep>1){s.theDate.setMinutes(s.theDate.getMinutes()-(s.theDate.getMinutes()%e.minuteStep))}p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate(),s.theDate.getHours(),s.theDate.getMinutes());p.setMinutes(p.getMinutes()+(g*e.minuteStep));k=(g===0)?e.pickPageButtonTheme:e.pickPageFlipButtonTheme;a("<li>",{"class":"ui-body-"+k,style:((c===true)?"margin-top: -933px":"")}).attr("data-offset",(g*e.minuteStep)).attr("data-theme",k).html("<span>"+s._zeroPad(p.getMinutes())+"</span>").appendTo(n);if(c===true){c=false}}break;case"a":n=s.pickerMeri.find("ul");n.html("");if(s.theDate.getHours()>11){c="-65";k=[e.pickPageFlipButtonTheme,e.pickPageButtonTheme]}else{c="-33";k=[e.pickPageButtonTheme,e.pickPageFlipButtonTheme]}a("<li>").appendTo(n).clone().appendTo(n);a("<li>",{"class":"ui-body-"+k[0],style:"margin-top: "+c+"px"}).attr("data-offset",1).attr("data-theme",k[0]).html("<span>"+e.meridiemLetters[0]+"</span>").appendTo(n);a("<li>",{"class":"ui-body-"+k[1]}).attr("data-offset",1).attr("data-theme",k[1]).html("<span>"+e.meridiemLetters[1]+"</span>").appendTo(n);a("<li>").appendTo(n).clone().appendTo(n);break}}}if(e.mode==="slidebox"){s._checkConstraints();f=s._makeDate(s.input.val());s.controlsHeader.html(s._formatHeader(s.theDate));s.controlsInput.html("");for(m=0;m<e.fieldsOrder.length;m++){r=a("<div>",{"data-rowtype":e.fieldsOrder[m]});if(e.wheelExists){r.bind("mousewheel",function(i,o){i.preventDefault();s._offset(a(this).attr("data-rowtype"),((o>0)?1:-1))})}n=a("<div>",{"class":"ui-datebox-sliderow-int","data-rowtype":e.fieldsOrder[m]}).appendTo(r);if(e.lang[e.useLang].isRTL===true){n.css("direction","rtl")}if(e.swipeEnabled){n.bind(s.START_DRAG,function(i){if(!s.dragMove){s.dragMove=true;s.dragTarget=a(this);s.dragPos=parseInt(s.dragTarget.css("marginLeft").replace(/px/i,""),10);s.dragStart=s.touch?i.originalEvent.changedTouches[0].pageX:i.pageX;s.dragEnd=false;i.stopPropagation();i.preventDefault()}})}switch(e.fieldsOrder[m]){case"y":r.addClass("ui-datebox-sliderow-ym");n.css("marginLeft","-333px");for(g=-5;g<6;g++){k=((f.getFullYear()===(s.theDate.getFullYear()+g))?e.pickPageHighButtonTheme:e.pickPageSlideButtonTheme);if(g===0){k=e.pickPageButtonTheme}a("<div>",{"class":"ui-datebox-slideyear ui-corner-all ui-btn-up-"+k}).html(s.theDate.getFullYear()+g).attr("data-offset",g).attr("data-theme",k).bind("vmouseover vmouseout",function(){s._hoover(this)}).bind(e.clickEvent,function(i){i.preventDefault();s._offset("y",parseInt(a(this).attr("data-offset"),10))}).appendTo(n)}break;case"m":r.addClass("ui-datebox-sliderow-ym");n.css("marginLeft","-204px");for(g=-6;g<7;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),1);p.setMonth(p.getMonth()+g);k=(f.getMonth()===p.getMonth()&&f.getYear()===p.getYear())?e.pickPageHighButtonTheme:e.pickPageSlideButtonTheme;if(g===0){k=e.pickPageButtonTheme}a("<div>",{"class":"ui-datebox-slidemonth ui-corner-all ui-btn-up-"+k}).attr("data-offset",g).attr("data-theme",k).html(e.lang[e.useLang].monthsOfYearShort[p.getMonth()]).bind("vmouseover vmouseout",function(){s._hoover(this)}).bind(e.clickEvent,function(i){i.preventDefault();s._offset("m",parseInt(a(this).attr("data-offset"),10))}).appendTo(n)}break;case"d":r.addClass("ui-datebox-sliderow-d");n.css("marginLeft","-386px");for(g=-15;g<16;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate());p.setDate(p.getDate()+g);k=(f.getDate()===p.getDate()&&f.getMonth()===p.getMonth()&&f.getYear()===p.getYear())?e.pickPageHighButtonTheme:e.pickPageSlideButtonTheme;if(g===0){k=e.pickPageButtonTheme}a("<div>",{"class":"ui-datebox-slideday ui-corner-all ui-btn-up-"+k}).attr("data-offset",g).attr("data-theme",k).html(p.getDate()+'<br /><span class="ui-datebox-slidewday">'+e.lang[e.useLang].daysOfWeekShort[p.getDay()]+"</span>").bind("vmouseover vmouseout",function(){s._hoover(this)}).bind(e.clickEvent,function(i){i.preventDefault();s._offset("d",parseInt(a(this).attr("data-offset"),10))}).appendTo(n)}break;case"h":r.addClass("ui-datebox-sliderow-hi");n.css("marginLeft","-284px");for(g=-12;g<13;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate(),s.theDate.getHours());p.setHours(p.getHours()+g);k=(g===0)?e.pickPageButtonTheme:e.pickPageSlideButtonTheme;a("<div>",{"class":"ui-datebox-slidehour ui-corner-all ui-btn-up-"+k}).attr("data-offset",g).attr("data-theme",k).html(((e.lang[e.useLang].timeFormat===12||e.timeFormatOverride===12)?((p.getHours()===0)?'12<span class="ui-datebox-slidewday">AM</span>':((p.getHours()<12)?p.getHours()+'<span class="ui-datebox-slidewday">AM</span>':((p.getHours()===12)?'12<span class="ui-datebox-slidewday">PM</span>':(p.getHours()-12)+'<span class="ui-datebox-slidewday">PM</span>'))):p.getHours())).bind("vmouseover vmouseout",function(){s._hoover(this)}).bind(e.clickEvent,function(i){i.preventDefault();s._offset("h",parseInt(a(this).attr("data-offset"),10))}).appendTo(n)}break;case"i":r.addClass("ui-datebox-sliderow-hi");n.css("marginLeft","-896px");for(g=-30;g<31;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate(),s.theDate.getHours(),s.theDate.getMinutes());p.setMinutes(p.getMinutes()+g);k=(g===0)?e.pickPageButtonTheme:e.pickPageSlideButtonTheme;a("<div>",{"class":"ui-datebox-slidemins ui-corner-all ui-btn-up-"+k}).attr("data-offset",g).attr("data-theme",k).html(s._zeroPad(p.getMinutes())).bind("vmouseover vmouseout",function(){s._hoover(this)}).bind(e.clickEvent,function(i){i.preventDefault();s._offset("i",parseInt(a(this).attr("data-offset"),10))}).appendTo(n)}break}r.appendTo(s.controlsInput)}}if(e.mode==="datebox"){s._checkConstraints();s.controlsHeader.html(s._formatHeader(s.theDate));s.pickerMon.val(s.theDate.getMonth()+1);s.pickerDay.val(s.theDate.getDate());s.pickerYar.val(s.theDate.getFullYear())}if(e.mode==="calbox"){s.controlsInput.html(e.lang[e.useLang].monthsOfYear[s.theDate.getMonth()]+" "+s.theDate.getFullYear());s.controlsSet.html("");l={today:-1,highlightDay:-1,presetDay:-1,nexttoday:1,thisDate:new Date(),maxDate:new Date(),minDate:new Date(),currentMonth:false,weekMode:0,weekDays:null,thisTheme:e.pickPageButtonTheme};l.start=s._getFirstDay(s.theDate);l.end=s._getLastDate(s.theDate);l.lastend=s._getLastDateBefore(s.theDate);l.presetDate=s._makeDate(s.input.val());if(e.calStartDay>0){l.start=l.start-e.calStartDay;if(l.start<0){l.start=l.start+7}}l.prevtoday=l.lastend-(l.start-1);l.checkDates=(e.enableDates===false&&(e.afterToday!==false||e.beforeToday!==false||e.notToday!==false||e.maxDays!==false||e.minDays!==false||e.blackDates!==false||e.blackDays!==false));if(l.thisDate.getMonth()===s.theDate.getMonth()&&l.thisDate.getFullYear()===s.theDate.getFullYear()){l.currentMonth=true;l.highlightDay=l.thisDate.getDate()}if(s._checker(l.presetDate)===s._checker(s.theDate)){l.presetDay=l.presetDate.getDate()}s.calNoPrev=false;s.calNoNext=false;if(e.afterToday===true&&(l.currentMonth===true||(l.thisDate.getMonth()>=s.theDate.getMonth()&&s.theDate.getFullYear()===l.thisDate.getFullYear()))){s.calNoPrev=true}if(e.beforeToday===true&&(l.currentMonth===true||(l.thisDate.getMonth()<=s.theDate.getMonth()&&s.theDate.getFullYear()===l.thisDate.getFullYear()))){s.calNoNext=true}if(e.minDays!==false){l.minDate.setDate(l.minDate.getDate()-e.minDays);if(s.theDate.getFullYear()===l.minDate.getFullYear()&&s.theDate.getMonth()<=l.minDate.getMonth()){s.calNoPrev=true}}if(e.maxDays!==false){l.maxDate.setDate(l.maxDate.getDate()+e.maxDays);if(s.theDate.getFullYear()===l.maxDate.getFullYear()&&s.theDate.getMonth()>=l.maxDate.getMonth()){s.calNoNext=true}}if(e.calShowDays){if(e.lang[e.useLang].daysOfWeekShort.length<8){e.daysOfWeekShort=e.lang[e.useLang].daysOfWeekShort.concat(e.lang[e.useLang].daysOfWeekShort)}l.weekDays=a("<div>",{"class":"ui-datebox-gridrow"}).appendTo(s.controlsSet);if(e.lang[e.useLang].isRTL===true){l.weekDays.css("direction","rtl")}for(g=0;g<=6;g++){a("<div>"+e.lang[e.useLang].daysOfWeekShort[(g+e.calStartDay)%7]+"</div>").addClass("ui-datebox-griddate ui-datebox-griddate-empty ui-datebox-griddate-label").appendTo(l.weekDays)}}for(h=0;h<=5;h++){if(h===0||(h>0&&(l.today>0&&l.today<=l.end))){n=a("<div>",{"class":"ui-datebox-gridrow"}).appendTo(s.controlsSet);if(e.lang[e.useLang].isRTL===true){n.css("direction","rtl")}for(j=0;j<=6;j++){if(j===0){l.weekMode=(l.today<1)?(l.prevtoday-l.lastend+e.calWeekModeFirstDay):(l.today+e.calWeekModeFirstDay)}if(j===l.start&&h===0){l.today=1}if(l.today>l.end){l.today=-1}if(l.today<1){if(e.calShowOnlyMonth){a("<div>",{"class":"ui-datebox-griddate ui-datebox-griddate-empty"}).appendTo(n)}else{if(e.enableDates!==false){if((a.inArray(s._isoDate(s.theDate.getFullYear(),(s.theDate.getMonth()),l.prevtoday),e.enableDates)>-1)||(a.inArray(s._isoDate(s.theDate.getFullYear(),(s.theDate.getMonth()+2),l.nexttoday),e.enableDates)>-1)){q=false}else{q=true}}else{if((e.afterToday!==false&&h===0&&l.thisDate.getMonth()>=s.theDate.getMonth()-1&&s.theDate.getFullYear()===l.thisDate.getFullYear()&&l.thisDate.getDate()>l.prevtoday)||(e.beforeToday!==false&&h!==0&&l.thisDate.getMonth()<=s.theDate.getMonth()+1&&s.theDate.getFullYear()===l.thisDate.getFullYear()&&l.thisDate.getDate()<l.nexttoday)||(e.blackDays!==false&&a.inArray(j,e.blackDays)>-1)||(e.blackDates!==false&&a.inArray(s._isoDate(s.theDate.getFullYear(),(s.theDate.getMonth()),l.prevtoday),e.blackDates)>-1)||(e.blackDates!==false&&a.inArray(s._isoDate(s.theDate.getFullYear(),(s.theDate.getMonth()+2),l.nexttoday),e.blackDates)>-1)){q=true}else{q=false}}if(h===0){a("<div>"+String(l.prevtoday)+"</div>").addClass("ui-datebox-griddate ui-datebox-griddate-empty").appendTo(n).attr("data-date",((e.calWeekMode)?(l.weekMode+l.lastend):l.prevtoday)).bind((!q)?e.clickEvent:"error",function(i){i.preventDefault();if(!s.calNoPrev){s.theDate.setMonth(s.theDate.getMonth()-1);s.theDate.setDate(a(this).attr("data-date"));s.input.trigger("datebox",{method:"set",value:s._formatDate(s.theDate),date:s.theDate});s.input.trigger("datebox",{method:"close"})}});l.prevtoday++}else{a("<div>"+String(l.nexttoday)+"</div>").addClass("ui-datebox-griddate ui-datebox-griddate-empty").appendTo(n).attr("data-date",((e.calWeekMode)?l.weekMode:l.nexttoday)).bind((!q)?e.clickEvent:"error",function(i){i.preventDefault();if(!s.calNoNext){s.theDate.setDate(a(this).attr("data-date"));if(!e.calWeekMode){s.theDate.setMonth(s.theDate.getMonth()+1)}s.input.trigger("datebox",{method:"set",value:s._formatDate(s.theDate),date:s.theDate});s.input.trigger("datebox",{method:"close"})}});l.nexttoday++}}}else{q=false;if(e.enableDates){if(a.inArray(s._isoDate(s.theDate.getFullYear(),s.theDate.getMonth()+1,l.today),e.enableDates)<0){q=true}}if(l.checkDates){if(e.afterToday&&s._checker(l.thisDate)>(s._checker(s.theDate)+l.today-s.theDate.getDate())){q=true}if(!q&&e.beforeToday&&s._checker(l.thisDate)<(s._checker(s.theDate)+l.today-s.theDate.getDate())){q=true}if(!q&&e.notToday&&l.today===l.highlightDay){q=true}if(!q&&e.maxDays!==false&&s._checker(l.maxDate)<(s._checker(s.theDate)+l.today-s.theDate.getDate())){q=true}if(!q&&e.minDays!==false&&s._checker(l.minDate)>(s._checker(s.theDate)+l.today-s.theDate.getDate())){q=true}if(!q&&(e.blackDays!==false||e.blackDates!==false)){if((a.inArray(j,e.blackDays)>-1)||(a.inArray(s._isoDate(s.theDate.getFullYear(),s.theDate.getMonth()+1,l.today),e.blackDates)>-1)){q=true}}}if(e.calHighPicked&&l.today===l.presetDay){l.thisTheme=e.pickPageHighButtonTheme}else{if(e.calHighToday&&l.today===l.highlightDay){l.thisTheme=e.pickPageTodayButtonTheme}else{if(a.isArray(e.highDatesAlt)&&(a.inArray(s._isoDate(s.theDate.getFullYear(),s.theDate.getMonth()+1,l.today),e.highDatesAlt)>-1)){l.thisTheme=e.pickPageOAHighButtonTheme}else{if(a.isArray(e.highDates)&&(a.inArray(s._isoDate(s.theDate.getFullYear(),s.theDate.getMonth()+1,l.today),e.highDates)>-1)){l.thisTheme=e.pickPageOHighButtonTheme}else{if(a.isArray(e.highDays)&&a.inArray(j,e.highDays)>-1){l.thisTheme=e.pickPageODHighButtonTheme}else{l.thisTheme=e.pickPageButtonTheme}}}}}a("<div>"+String(l.today)+"</div>").addClass("ui-datebox-griddate ui-corner-all").attr("data-date",((e.calWeekMode)?l.weekMode:l.today)).attr("data-theme",l.thisTheme).appendTo(n).addClass("ui-btn-up-"+l.thisTheme).bind("vmouseover vmouseout",function(){if(e.calWeekMode!==false&&e.calWeekModeHighlight===true){a(this).parent().find("div").each(function(){s._hoover(this)})}else{s._hoover(this)}}).bind((!q)?e.clickEvent:"error",function(i){i.preventDefault();s.theDate.setDate(a(this).attr("data-date"));s.input.trigger("datebox",{method:"set",value:s._formatDate(s.theDate),date:s.theDate});s.input.trigger("datebox",{method:"close"})}).css((q)?"color":"nocolor",e.disabledDayColor);l.today++}}}}}if(e.lang[this.options.useLang].useArabicIndic===true){s._makeDisplayIndic()}},_create:function(){a(document).trigger("dateboxcreate");var i=this,j=a.extend(this.options,this.element.data("options")),h=this.element,e=(j.theme===false&&typeof(a(i).attr("data-theme"))==="undefined")?((typeof(h.parentsUntil("[data-theme]").parent().attr("data-theme"))==="undefined")?j.defaultTheme:h.parentsUntil("[data-theme]").parent().attr("data-theme")):j.theme,y=h.wrap('<div class="ui-input-datebox ui-shadow-inset ui-corner-all ui-body-'+e+'"></div>').parent(),m=new Date(),u=new Date(m.getTime()),l=a('<a href="#" class="ui-input-clear" title="date picker">date picker</a>').bind(j.clickEvent,function(o){o.preventDefault();if(!j.disabled){i.input.trigger("datebox",{method:"open"})}setTimeout(function(){a(o.target).closest("a").removeClass(a.mobile.activeBtnClass)},300)}).appendTo(y).buttonMarkup({icon:"grid",iconpos:"notext",corners:true,shadow:true}).css({"vertical-align":"middle","float":"right"}),c=h.closest(".ui-page"),q=a("<div data-role='dialog' class='ui-dialog-datebox' data-theme='"+((j.forceInheritTheme===false)?j.pickPageTheme:e)+"' ><div data-role='header' data-backbtn='false' data-theme='a'><div class='ui-title'>PlaceHolder</div></div><div data-role='content'></div></div>").appendTo(a.mobile.pageContainer).page().css("minHeight","0px").css("zIndex",j.zindex).addClass(j.transition),d=q.find(".ui-title"),f=q.find(".ui-content"),g=("ontouchstart" in window),p=g?"touchstart":"mousedown",t=g?"touchmove":"mousemove",k=g?"touchend":"mouseup",v=false,s=false,n=false,r=false,w=false,x=0;j.theme=e;if(j.forceInheritTheme){j.pickPageTheme=e;j.pickPageInputTheme=e;j.pickPageButtonTheme=e}if(j.defaultPickerValue===false&&j.defaultDate!==false){j.defaultPickerValue=j.defaultDate}a("label[for="+h.attr("id")+"]").addClass("ui-input-text").css("verticalAlign","middle");if(j.mode==="timeflipbox"){j.lang[j.useLang].headerFormat=" "}if(j.noButtonFocusMode||j.useInline||j.noButton){l.hide()}y.bind(j.clickEvent,function(){if(!j.disabled&&j.noButtonFocusMode){h.trigger("datebox",{method:"open"})}});h.removeClass("ui-corner-all ui-shadow-inset").focus(function(){if(!j.disabled){y.addClass("ui-focus");if(j.noButtonFocusMode){y.addClass("ui-focus");h.trigger("datebox",{method:"open"})}}h.removeClass("ui-focus")}).blur(function(){y.removeClass("ui-focus");h.removeClass("ui-focus")}).change(function(){i.theDate=i._makeDate(i.input.val());i._update()});h.bind("datebox",i._dateboxHandler);q.find(".ui-header a").bind(j.clickEvent,function(o){o.preventDefault();o.stopImmediatePropagation();i.input.trigger("datebox",{method:"close",fromCloseButton:true})});a.extend(i,{pickPage:q,thisPage:c,pickPageContent:f,pickPageTitle:d,input:h,theDate:m,initDate:u,focusedEl:y,touch:g,START_DRAG:p,MOVE_DRAG:t,END_DRAG:k,dragMove:v,dragStart:s,dragEnd:n,dragPos:r});if(typeof a.event.special.mousewheel!=="undefined"){j.wheelExists=true}i._buildPage();if(j.swipeEnabled){a(document).bind(i.MOVE_DRAG,function(o){if(i.dragMove){if(j.mode==="slidebox"){i.dragEnd=i.touch?o.originalEvent.changedTouches[0].pageX:o.pageX;i.dragTarget.css("marginLeft",(i.dragPos+i.dragEnd-i.dragStart)+"px");o.preventDefault();o.stopPropagation();return false}else{if(j.mode==="flipbox"||j.mode==="timeflipbox"){i.dragEnd=i.touch?o.originalEvent.changedTouches[0].pageY:o.pageY;i.dragTarget.css("marginTop",(i.dragPos+i.dragEnd-i.dragStart)+"px");o.preventDefault();o.stopPropagation();return false}else{if(j.mode==="durationbox"||j.mode==="timebox"||j.mode==="datebox"){i.dragEnd=i.touch?o.originalEvent.changedTouches[0].pageY:o.pageY;if((i.dragEnd-i.dragStart)%2===0){x=(i.dragEnd-i.dragStart)/-2;if(x<i.dragPos){i._offset(i.dragTarget,-1*(i.dragTarget==="i"?j.minuteStep:1))}else{if(x>i.dragPos){i._offset(i.dragTarget,(i.dragTarget==="i"?j.minuteStep:1))}}i.dragPos=x}o.preventDefault();o.stopPropagation();return false}}}}});a(document).bind(i.END_DRAG,function(A){if(i.dragMove){i.dragMove=false;if(j.mode==="slidebox"){if(i.dragEnd!==false&&Math.abs(i.dragStart-i.dragEnd)>25){A.preventDefault();A.stopPropagation();switch(i.dragTarget.parent().data("rowtype")){case"y":i._offset("y",parseInt((i.dragStart-i.dragEnd)/84,10));break;case"m":i._offset("m",parseInt((i.dragStart-i.dragEnd)/51,10));break;case"d":i._offset("d",parseInt((i.dragStart-i.dragEnd)/32,10));break;case"h":i._offset("h",parseInt((i.dragStart-i.dragEnd)/32,10));break;case"i":i._offset("i",parseInt((i.dragStart-i.dragEnd)/32,10));break}}}else{if(j.mode==="flipbox"||j.mode==="timeflipbox"){if(i.dragEnd!==false){A.preventDefault();A.stopPropagation();var z=i.dragTarget.parent().parent().data("field"),o=parseInt((i.dragStart-i.dragEnd)/30,10);i._offset(z,o*((z==="i")?j.minuteStep:1))}}}i.dragStart=false;i.dragEnd=false}})}if(h.is(":disabled")){i.disable()}if(j.disableManualInput===true){h.attr("readonly",true)}a(document).bind("orientationchange",function(o){h.trigger("orientationchange")});if(j.resizeListener===true){a(window).bind("resize",function(o){h.trigger("orientationchange")})}h.bind("orientationchange",i._orientChange);a(document).trigger("dateboxaftercreate")},_makeElement:function(f,g){var c=this,d=false,e=false;e=f.clone();if("attr" in g){for(d in g.attr){e.attr("data-"+d,g.attr[d])}}return e},_eventEnterValue:function(d){var c=this,e=c.options,f=false;if(d.val()!==""&&c._isInt(d.val())){switch(d.attr("data-field")){case"m":c.theDate.setMonth(parseInt(d.val(),10)-1);break;case"d":c.theDate.setDate(parseInt(d.val(),10));break;case"y":c.theDate.setFullYear(parseInt(d.val(),10));break;case"i":c.theDate.setMinutes(parseInt(d.val(),10));break;case"h":f=parseInt(d.val(),10);if(f===12){if((e.lang[e.useLang].timeFormat===12||e.timeFormatOverride===12)&&c.pickerMeri.val()===e.meridiemLetters[0]){f=0}}c.theDate.setHours(f);break}c._update()}},_buildInternals:function(){var n=this,q=n.options,l,t,e,u=a("<div><a href='#'></a></div>"),f=a("<div>",{"class":"ui-datebox-container ui-overlay-shadow ui-corner-all ui-datebox-hidden pop ui-body-"+q.pickPageTheme}).css("zIndex",q.zindex),v=a("<input type='text' />").addClass("ui-input-text ui-corner-all ui-shadow-inset ui-datebox-input ui-body-"+q.pickPageInputTheme),j=a("<div>",{"class":"ui-datebox-controls"}),i=a("<div class='ui-overlay-shadow'><ul></ul></div>"),h,y,m,r,s,d,g,k,w,z,p,c;n.calNoNext=false;n.calNoPrev=false;n.setButton=false;if(q.fieldsOrderOverride===false){switch(q.mode){case"timebox":case"timeflipbox":q.fieldsOrder=q.lang[q.useLang].timeFieldOrder;break;case"slidebox":q.fieldsOrder=q.lang[q.useLang].slideFieldOrder;break;default:q.fieldsOrder=q.lang[q.useLang].dateFieldOrder}}else{q.fieldsOrder=q.fieldsOrderOverride}if(q.timeFormatOverride===false){q.timeOutput=q.timeFormats[q.lang[q.useLang].timeFormat]}else{q.timeOutput=q.timeFormats[q.timeFormatOverride]}if(q.dateFormat!==false){q.dateOutput=q.dateFormat}else{if("dateFormat" in q.lang[q.useLang]){q.dateOutput=q.lang[q.useLang].dateFormat}else{q.dateOutput=q.defaultDateFormat}}n.pickerContent.html("");if(q.mode==="datebox"||q.mode==="timebox"){s=a("<div class='ui-datebox-header'><h4>Unitialized</h4></div>").appendTo(n.pickerContent).find("h4");h=j.clone().appendTo(n.pickerContent);y=j.clone().appendTo(n.pickerContent);m=j.clone().appendTo(n.pickerContent);r=j.clone().appendTo(n.pickerContent);if(q.mode==="timebox"){s.parent().html("")}w=n._makeElement(v,{attr:{field:"m"}}).keyup(function(){n._eventEnterValue(a(this))});z=n._makeElement(v,{attr:{field:"d"}}).keyup(function(){n._eventEnterValue(a(this))});p=n._makeElement(v,{attr:{field:"y"}}).keyup(function(){n._eventEnterValue(a(this))});d=n._makeElement(v,{attr:{field:"h"}}).keyup(function(){n._eventEnterValue(a(this))});g=n._makeElement(v,{attr:{field:"i"}}).keyup(function(){n._eventEnterValue(a(this))});k=n._makeElement(v,{attr:{field:"a"}}).keyup(function(){n._eventEnterValue(a(this))});if(q.wheelExists){p.bind("mousewheel",function(o,x){o.preventDefault();n._offset("y",(x<0)?-1:1)});w.bind("mousewheel",function(o,x){o.preventDefault();n._offset("m",(x<0)?-1:1)});z.bind("mousewheel",function(o,x){o.preventDefault();n._offset("d",(x<0)?-1:1)});d.bind("mousewheel",function(o,x){o.preventDefault();n._offset("h",(x<0)?-1:1)});g.bind("mousewheel",function(o,x){o.preventDefault();n._offset("i",((x<0)?-1:1)*q.minuteStep)});k.bind("mousewheel",function(o,x){o.preventDefault();n._offset("a",x)})}for(l=0;l<=q.fieldsOrder.length;l++){if(q.fieldsOrder[l]==="y"){p.appendTo(y)}if(q.fieldsOrder[l]==="m"){w.appendTo(y)}if(q.fieldsOrder[l]==="d"){z.appendTo(y)}if(q.fieldsOrder[l]==="h"){d.appendTo(y)}if(q.fieldsOrder[l]==="i"){g.appendTo(y)}if(q.fieldsOrder[l]==="a"&&(q.lang[q.useLang].timeFormat===12||q.timeFormatOverride===12)){k.appendTo(y)}}if(q.swipeEnabled){y.find("input").bind(n.START_DRAG,function(o){if(!n.dragMove){n.dragMove=true;n.dragTarget=a(this).data("field");n.dragPos=0;n.dragStart=n.touch?o.originalEvent.changedTouches[0].pageY:o.pageY;n.dragEnd=false;o.stopPropagation()}})}if(q.noSetButton===false){n.setButton=a("<a href='#'>PlaceHolder</a>").appendTo(r).buttonMarkup({theme:q.pickPageTheme,icon:"check",iconpos:"left",corners:true,shadow:true}).bind(q.clickEvent,function(o){o.preventDefault();if(q.mode==="timebox"){n.input.trigger("datebox",{method:"set",value:n._formatTime(n.theDate),date:n.theDate})}else{n.input.trigger("datebox",{method:"set",value:n._formatDate(n.theDate),date:n.theDate})}n.input.trigger("datebox",{method:"close"})})}for(l=0;l<n.options.fieldsOrder.length;l++){if(q.fieldsOrder[l]!=="a"||q.lang[q.useLang].timeFormat===12||q.timeFormatOverride===12){u.clone().appendTo(h).buttonMarkup({theme:q.pickPageButtonTheme,icon:"plus",iconpos:"bottom",corners:true,shadow:true}).attr("data-field",q.fieldsOrder[l]).bind(q.clickEvent,function(o){o.preventDefault();n._offset(a(this).attr("data-field"),(a(this).attr("data-field")==="i"?q.minuteStep:1))});u.clone().appendTo(m).buttonMarkup({theme:q.pickPageButtonTheme,icon:"minus",iconpos:"top",corners:true,shadow:true}).attr("data-field",q.fieldsOrder[l]).bind(q.clickEvent,function(o){o.preventDefault();n._offset(a(this).attr("data-field"),-1*(a(this).attr("data-field")==="i"?q.minuteStep:1))})}}a.extend(n,{controlsHeader:s,pickerDay:z,pickerMon:w,pickerYar:p,pickerHour:d,pickerMins:g,pickerMeri:k});n.pickerContent.appendTo(n.thisPage)}if(q.mode==="durationbox"){h=j.clone().removeClass("ui-datebox-controls").addClass("ui-datebox-scontrols").appendTo(n.pickerContent);y=h.clone().appendTo(n.pickerContent);m=h.clone().appendTo(n.pickerContent);r=j.clone().appendTo(n.pickerContent);z=v.removeClass("ui-datebox-input").clone().keyup(function(){if(a(this).val()!==""){n._updateduration()}});d=z.clone().keyup(function(){if(a(this).val()!==""){n._updateduration()}});g=z.clone().keyup(function(){if(a(this).val()!==""){n._updateduration()}});c=z.clone().keyup(function(){if(a(this).val()!==""){n._updateduration()}});if(q.wheelExists){z.bind("mousewheel",function(o,x){o.preventDefault();n._offset("d",((x<0)?-1:1)*q.durationSteppers.d)});d.bind("mousewheel",function(o,x){o.preventDefault();n._offset("h",((x<0)?-1:1)*q.durationSteppers.h)});g.bind("mousewheel",function(o,x){o.preventDefault();n._offset("i",((x<0)?-1:1)*q.durationSteppers.i)});c.bind("mousewheel",function(o,x){o.preventDefault();n._offset("s",((x<0)?-1:1)*q.durationSteppers.s)})}for(l=0;l<q.durationOrder.length;l++){switch(q.durationOrder[l]){case"d":a("<div>",{"class":"ui-datebox-sinput","data-field":"d"}).append(z).appendTo(y).prepend("<label>"+q.lang[q.useLang].durationLabel[0]+"</label>");break;case"h":a("<div>",{"class":"ui-datebox-sinput","data-field":"h"}).append(d).appendTo(y).prepend("<label>"+q.lang[q.useLang].durationLabel[1]+"</label>");break;case"i":a("<div>",{"class":"ui-datebox-sinput","data-field":"i"}).append(g).appendTo(y).prepend("<label>"+q.lang[q.useLang].durationLabel[2]+"</label>");break;case"s":a("<div>",{"class":"ui-datebox-sinput","data-field":"s"}).append(c).appendTo(y).prepend("<label>"+q.lang[q.useLang].durationLabel[3]+"</label>");break}}if(q.swipeEnabled){y.find("input").bind(n.START_DRAG,function(o){if(!n.dragMove){n.dragMove=true;n.dragTarget=a(this).parent().data("field");n.dragPos=0;n.dragStart=n.touch?o.originalEvent.changedTouches[0].pageY:o.pageY;n.dragEnd=false;o.stopPropagation()}})}if(q.noSetButton===false){n.setButton=a("<a href='#'>PlaceHolder</a>").appendTo(r).buttonMarkup({theme:q.pickPageTheme,icon:"check",iconpos:"left",corners:true,shadow:true}).bind(q.clickEvent,function(o){o.preventDefault();n.input.trigger("datebox",{method:"set",value:n._formatTime(n.theDate),date:n.theDate});n.input.trigger("datebox",{method:"close"})})}for(l=0;l<q.durationOrder.length;l++){u.clone().appendTo(h).buttonMarkup({theme:q.pickPageButtonTheme,icon:"plus",iconpos:"bottom",corners:true,shadow:true}).attr("data-field",q.durationOrder[l]).bind(q.clickEvent,function(o){o.preventDefault();n._offset(a(this).attr("data-field"),q.durationSteppers[a(this).attr("data-field")])});u.clone().appendTo(m).buttonMarkup({theme:q.pickPageButtonTheme,icon:"minus",iconpos:"top",corners:true,shadow:true}).attr("data-field",q.durationOrder[l]).bind(q.clickEvent,function(o){o.preventDefault();n._offset(a(this).attr("data-field"),-1*q.durationSteppers[a(this).attr("data-field")])})}a.extend(n,{pickerHour:d,pickerMins:g,pickerDay:z,pickerSecs:c});n.pickerContent.appendTo(n.thisPage)}if(q.mode==="slidebox"){s=a("<div class='ui-datebox-header'><h4>Unitialized</h4></div>").appendTo(n.pickerContent).find("h4");y=a("<div>").addClass("ui-datebox-slide").appendTo(n.pickerContent);r=a("<div>",{"class":"ui-datebox-controls"}).appendTo(n.pickerContent);if(q.noSetButton===false){n.setButton=a("<a href='#'>PlaceHolder</a>").appendTo(r).buttonMarkup({theme:q.pickPageTheme,icon:"check",iconpos:"left",corners:true,shadow:true}).bind(q.clickEvent,function(o){o.preventDefault();n.input.trigger("datebox",{method:"set",value:n._formatDate(n.theDate),date:n.theDate});n.input.trigger("datebox",{method:"close"})})}a.extend(n,{controlsHeader:s,controlsInput:y});n.pickerContent.appendTo(n.thisPage)}if(q.mode==="flipbox"||q.mode==="timeflipbox"){s=a("<div class='ui-datebox-header'><h4>Unitialized</h4></div>").appendTo(n.pickerContent).find("h4");y=a("<div>",{"class":"ui-datebox-flipcontent"}).appendTo(n.pickerContent);h=a("<div>",{"class":"ui-datebox-flipcenter ui-overlay-shadow"}).appendTo(n.pickerContent);r=j.clone().appendTo(n.pickerContent);z=n._makeElement(i,{attr:{field:"d"}});w=n._makeElement(i,{attr:{field:"m"}});p=n._makeElement(i,{attr:{field:"y"}});d=n._makeElement(i,{attr:{field:"h"}});g=n._makeElement(i,{attr:{field:"i"}});k=n._makeElement(i,{attr:{field:"a"}});if(q.wheelExists){p.bind("mousewheel",function(o,x){o.preventDefault();n._offset("y",(x<0)?-1:1)});w.bind("mousewheel",function(o,x){o.preventDefault();n._offset("m",(x<0)?-1:1)});z.bind("mousewheel",function(o,x){o.preventDefault();n._offset("d",(x<0)?-1:1)});d.bind("mousewheel",function(o,x){o.preventDefault();n._offset("h",(x<0)?-1:1)});g.bind("mousewheel",function(o,x){o.preventDefault();n._offset("i",((x<0)?-1:1)*q.minuteStep)});k.bind("mousewheel",function(o,x){o.preventDefault();n._offset("a",x)});h.bind("mousewheel",function(o,x){o.preventDefault();if(q.fieldsOrder.length===3){e=q.fieldsOrder[parseInt((o.pageX-a(o.currentTarget).offset().left)/87,10)]}else{if(q.fieldsOrder.length===2){e=q.fieldsOrder[parseInt((o.pageX-a(o.currentTarget).offset().left)/130,10)]}}n._offset(e,((x<0)?-1:1)*((e==="i")?q.minuteStep:1))})}for(l=0;l<=q.fieldsOrder.length;l++){if(q.fieldsOrder[l]==="y"){p.appendTo(y)}if(q.fieldsOrder[l]==="m"){w.appendTo(y)}if(q.fieldsOrder[l]==="d"){z.appendTo(y)}if(q.fieldsOrder[l]==="h"){d.appendTo(y)}if(q.fieldsOrder[l]==="i"){g.appendTo(y)}if(q.fieldsOrder[l]==="a"&&(q.lang[q.useLang].timeFormat===12||q.timeFormatOverride===12)){k.appendTo(y)}}if(q.swipeEnabled){y.find("ul").bind(n.START_DRAG,function(x,o){if(!n.dragMove){if(typeof o!=="undefined"){x=o}n.dragMove=true;n.dragTarget=a(this).find("li").first();n.dragPos=parseInt(n.dragTarget.css("marginTop").replace(/px/i,""),10);n.dragStart=n.touch?x.originalEvent.changedTouches[0].pageY:x.pageY;n.dragEnd=false;x.stopPropagation();x.preventDefault()}});h.bind(n.START_DRAG,function(o){if(!n.dragMove){n.dragTarget=n.touch?o.originalEvent.changedTouches[0].pageX-a(o.currentTarget).offset().left:o.pageX-a(o.currentTarget).offset().left;if(q.fieldsOrder.length===3){a(n.controlsInput.find("ul").get(parseInt(n.dragTarget/87,10))).trigger(n.START_DRAG,o)}else{if(q.fieldsOrder.length===2){a(n.controlsInput.find("ul").get(parseInt(n.dragTarget/130,10))).trigger(n.START_DRAG,o)}}}})}if(q.noSetButton===false){n.setButton=a("<a href='#'>PlaceHolder</a>").appendTo(r).buttonMarkup({theme:q.pickPageTheme,icon:"check",iconpos:"left",corners:true,shadow:true}).bind(q.clickEvent,function(o){o.preventDefault();if(q.mode==="timeflipbox"){n.input.trigger("datebox",{method:"set",value:n._formatTime(n.theDate),date:n.theDate})}else{n.input.trigger("datebox",{method:"set",value:n._formatDate(n.theDate),date:n.theDate})}n.input.trigger("datebox",{method:"close"})})}a.extend(n,{controlsHeader:s,controlsInput:y,pickerDay:z,pickerMon:w,pickerYar:p,pickerHour:d,pickerMins:g,pickerMeri:k});n.pickerContent.appendTo(n.thisPage)}if(q.mode==="calbox"){s=a("<div>",{"class":"ui-datebox-gridheader"}).appendTo(n.pickerContent);r=a("<div>",{"class":"ui-datebox-grid"}).appendTo(n.pickerContent);y=a("<div class='ui-datebox-gridlabel'><h4>Uninitialized</h4></div>").appendTo(s).find("h4");if(q.swipeEnabled){n.pickerContent.bind("swipeleft",function(){if(!n.calNoNext){n._offset("m",1)}}).bind("swiperight",function(){if(!n.calNoPrev){n._offset("m",-1)}})}if(q.wheelExists){n.pickerContent.bind("mousewheel",function(o,x){o.preventDefault();if(x>0&&!n.calNoNext){if(n.theDate.getDate()>28){n.theDate.setDate(1)}n._offset("m",1)}if(x<0&&!n.calNoPrev){if(n.theDate.getDate()>28){n.theDate.setDate(1)}n._offset("m",-1)}})}a("<div class='ui-datebox-gridplus"+((q.lang[q.useLang].isRTL===true)?"-rtl":"")+"'><a href='#'>Next Month</a></div>").prependTo(s).buttonMarkup({theme:q.pickPageButtonTheme,icon:"plus",inline:true,iconpos:"notext",corners:true,shadow:true}).bind(q.clickEvent,function(o){o.preventDefault();if(!n.calNoNext){if(n.theDate.getDate()>28){n.theDate.setDate(1)}n._offset("m",1)}});a("<div class='ui-datebox-gridminus"+((q.lang[q.useLang].isRTL===true)?"-rtl":"")+"'><a href='#'>Prev Month</a></div>").prependTo(s).buttonMarkup({theme:q.pickPageButtonTheme,icon:"minus",inline:true,iconpos:"notext",corners:true,shadow:true}).bind(q.clickEvent,function(o){o.preventDefault();if(!n.calNoPrev){if(n.theDate.getDate()>28){n.theDate.setDate(1)}n._offset("m",-1)}});if(q.calTodayButton===true){n.setButton=a("<a href='#'>PlaceHolder</a>").appendTo(n.pickerContent).buttonMarkup({theme:q.pickPageTheme,icon:"check",iconpos:"left",corners:true,shadow:true}).bind(q.clickEvent,function(o){o.preventDefault();n.theDate=new Date();n.theDate=new Date(n.theDate.getFullYear(),n.theDate.getMonth(),n.theDate.getDate(),0,0,0,0);n.input.trigger("datebox",{method:"doset"})})}a.extend(n,{controlsInput:y,controlsSet:r});n.pickerContent.appendTo(n.thisPage)}},_buttonsTitle:function(){var c=this,d=this.options;if(d.titleDialogLabel===false){switch(d.mode){case"timebox":case"timeflipbox":c.pickPageTitle.html(d.lang[d.useLang].titleTimeDialogLabel);break;default:c.pickPageTitle.html(d.lang[d.useLang].titleDateDialogLabel);break}}else{c.pickPageTitle.html(d.titleDialogLabel)}if(c.setButton!==false){switch(d.mode){case"timebox":case"timeflipbox":c.setButton.find(".ui-btn-text").html(d.lang[d.useLang].setTimeButtonLabel);break;case"durationbox":c.setButton.find(".ui-btn-text").html(d.lang[d.useLang].setDurationButtonLabel);break;case"calbox":c.setButton.find(".ui-btn-text").html(d.lang[d.useLang].calTodayButtonLabel);break;default:c.setButton.find(".ui-btn-text").html(d.lang[d.useLang].setDateButtonLabel);break}}},_buildPage:function(){var d=this,e=d.options,f=a("<div>",{"class":"ui-datebox-container ui-overlay-shadow ui-corner-all ui-datebox-hidden "+e.transition+" ui-body-"+e.pickPageTheme}).css("zIndex",e.zindex),c=a("<div>",{"class":"ui-datebox-screen ui-datebox-hidden"+((e.useModal)?" ui-datebox-screen-modal":"")}).css({"z-index":e.zindex-1}).appendTo(d.thisPage).bind(e.clickEvent,function(g){g.preventDefault();d.input.trigger("datebox",{method:"close"})});if(e.noAnimation){f.removeClass(e.transition)}a.extend(d,{pickerContent:f,screen:c});d._buildInternals();if(e.useInline||e.useInlineBlind){d.input.parent().parent().append(d.pickerContent);if(e.useInlineHideInput){d.input.parent().hide()}d.input.trigger("change");d.pickerContent.removeClass("ui-datebox-hidden")}else{if(e.centerWindow&&e.useInlineHideInput){d.input.parent().hide()}}if(e.useInline){d.pickerContent.addClass("ui-datebox-inline");d.open()}if(e.useInlineBlind){d.pickerContent.addClass("ui-datebox-inlineblind");d.pickerContent.hide()}},hardreset:function(){this._buildInternals();this.refresh();this._buttonsTitle()},refresh:function(){if(this.options.useInline===true){this.input.trigger("change")}this._update()},open:function(){if(this.options.openCallback!==false){if(a.isFunction(this.options.openCallback())&&!this.options.openCallback()){return false}else{var n=new Function(this.options.openCallback);if(!n()){return false}}}var p=this,d=this.options,i=p.focusedEl.offset(),q=p.pickerContent.outerHeight(),l=p.pickerContent.innerWidth(),g=i.top+(p.focusedEl.outerHeight()/2)-(q/2),m=i.left+(p.focusedEl.outerWidth()/2)-(l/2),k=d.noAnimation?"none":d.transition,f=a(window).scrollTop(),h=a(window).scrollLeft(),e=a(document).width(),j=a(window).height(),c;p._buttonsTitle();if(this.options.useInlineBlind){this.pickerContent.slideDown();return false}if(this.options.useInline){return true}if(this.pickPage.is(":visible")){return false}this.theDate=this._makeDate(this.input.val());this._update();this.input.blur();if((m+l)>a(document).width()){m=a(document).width()-l-1}if(m<0){m=0}if(d.centerWindow){m=(a(document).width()/2)-(l/2)}if((q+g)>a(document).height()){g=a(document).height()-(q+2)}if(g<45){g=45}if((a(document).width()>400&&!d.useDialogForceTrue)||d.useDialogForceFalse||d.fullScreen){d.useDialog=false;if(d.nestedBox===true&&d.fullScreen===false){if(q===0){q=250;g=i.top+(p.focusedEl.outerHeight()/2)-(q/2)}c=a(".ui-page-active").first();a(c).append(p.pickerContent);a(c).append(p.screen)}if(d.fullScreenAlways===false||a(document).width()>399){if(d.useModal===true){p.screen.fadeIn("slow")}else{p.screen.removeClass("ui-datebox-hidden")}}if(d.fullScreenAlways===true||(d.fullScreen===true&&a(document).width()<400)){p.pickerContent.addClass("ui-overlay-shadow in").css({position:"absolute","text-align":"center",top:f,left:h,height:j,width:e,border:"0px !important"}).removeClass("ui-datebox-hidden")}else{p.pickerContent.addClass("ui-overlay-shadow in").css({position:"absolute",top:g,left:m}).removeClass("ui-datebox-hidden")}}else{p.thisPage.unbind("pagehide.remove");d.useDialog=true;p.pickPageContent.append(p.pickerContent);p.pickerContent.css({top:"auto",left:"auto",marginLeft:"auto",marginRight:"auto"}).removeClass("ui-overlay-shadow ui-datebox-hidden");a.mobile.changePage(p.pickPage,{transition:k})}},close:function(c){var d=this,e;if(this.options.useInlineBlind){this.pickerContent.slideUp();return false}if(d.options.useInline){return true}if(d.options.useDialog){if(!c){a(d.pickPage).dialog("close")}if(!d.thisPage.data("page").options.domCache){d.thisPage.bind("pagehide.remove",function(){a(d).remove()})}d.pickerContent.addClass("ui-datebox-hidden").removeAttr("style").css("zIndex",d.options.zindex);d.thisPage.append(d.pickerContent)}else{if(d.options.useModal){d.screen.fadeOut("slow")}else{d.screen.addClass("ui-datebox-hidden")}d.pickerContent.addClass("ui-datebox-hidden").removeAttr("style").css("zIndex",d.options.zindex).removeClass("in")}d.focusedEl.removeClass("ui-focus");if(d.options.closeCallback!==false){if(a.isFunction(d.options.closeCallback)){d.options.closeCallback(d.theDate,d)}else{e=new Function(d.options.closeCallback);e(d.theDate,d)}}},disable:function(){this.element.attr("disabled",true);this.element.parent().addClass("ui-disabled");this.options.disabled=true;this.element.blur();this.input.trigger("datebox",{method:"disable"})},enable:function(){this.element.attr("disabled",false);this.element.parent().removeClass("ui-disabled");this.options.disabled=false;this.input.trigger("datebox",{method:"enable"})},_setOption:function(d,e){var c=["minYear","maxYear","afterToday","beforeToday","maxDays","minDays","highDays","highDates","blackDays","blackDates","enableDates"];a.Widget.prototype._setOption.apply(this,arguments);if(a.inArray(d,c)>-1){this._refresh()}else{this.hardreset()}}});a(document).bind("pagebeforecreate",function(c){a(":jqmData(role='datebox')",c.target).each(function(){a(this).replaceWith(a("<div>").html(a(this).clone()).html().replace(/\s+type=["']date['"]?/,' type="text" '))})});a(document).bind("pagecreate create",function(c){a(document).trigger("dateboxbeforecreate");a(":jqmData(role='datebox')",c.target).each(function(){if(typeof(a(this).data("datebox"))==="undefined"){a(this).datebox()}})})})(jQuery);